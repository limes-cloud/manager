syntax = "proto3";

package manager.api.user;

option go_package = "manager/api/user;user";
option java_multiple_files = true;
option java_package = "manager.api.user";

import "validate/validate.proto";


message GetCurrentUserRequest{
  optional string app = 1;
}

message GetUserRequest{
 optional uint32 id = 1;
 optional string username = 2;
 optional string app = 3;
}

message UserObject {
  message Dept {
    uint32 id = 1;
    string name = 2;
    string logo = 3;
    bool main = 4;
  }

  message Job {
    uint32 id = 1;
    string name = 2;
  }

  message UserDept{
    uint32 deptId = 1;
    uint32 jobId = 2;
    Dept dept = 3;
    Job job = 4;
  }

  uint32 id = 1;
  string nickname = 2;
  string username = 3;
  string avatar = 4;
  string email = 5;
  string phone = 6;
  optional bool status = 7;
  uint32 loggedAt = 8;
  uint32 createdAt = 9;
  uint32 updatedAt = 10;
  string setting = 11;
  map<string, string> infos = 12;
  repeated UserDept userDepts = 13;
}

message ListUserRequest{
  uint32 page = 1[(validate.rules).uint32 = {gte: 1}];
  uint32 pageSize = 2[(validate.rules).uint32 = {gte: 1,lte:50}];
  optional uint32 appId = 3;
  optional uint32 deptId = 4;
  optional uint32 jobId = 5;
  optional string username = 6;
  optional bool status = 7;
  repeated int64 loggedAts = 8;
  repeated int64 createdAts = 9;
  repeated uint32 inIds = 10;
  repeated uint32 notInIds = 11;
}

message ListUserReply {
  uint32 total = 1;
  repeated UserObject list = 2;
}

message CreateUserRequest {
  string avatar = 1;
  string nickname = 2[(validate.rules).string = {min_len: 1,max_len: 64}];
  string username = 3[(validate.rules).string = {min_len: 6,max_len: 32}];
  map<string, string> infos = 6;
}

message CreateUserReply {
  uint32 id = 1;
}

message UpdateUserRequest {
  uint32 id = 1[(validate.rules).uint32 = {gte: 1}];
  optional string avatar = 2;
  optional string nickname = 3[(validate.rules).string = {min_len: 1,max_len: 64}];
  optional bool status = 6;
  optional string reason = 7;
  map<string, string> infos = 8;
}

message UpdateUserReply {
}

message DeleteUserRequest {
  uint32 id = 1[(validate.rules).uint32 = {gte: 1}];
}

message DeleteUserReply {
}

message ResetPasswordRequest {
  uint32 id = 1;
}

message UpdateCurrentUserSettingRequest{
  string app = 1[(validate.rules).string = {min_len: 1,max_len: 64}];
  string setting = 2[(validate.rules).string = {min_len: 4}];
}

message UpdateCurrentUserRequest {
  optional string nickname = 1[(validate.rules).string = {min_len: 1,max_len: 64}];
  optional string avatar= 2[(validate.rules).string = {min_len: 1,max_len: 64}];
  map<string, string> infos = 3;
}

message UpdateCurrentUserReply {
}


message UpdateCurrentUserPasswordRequest {
   string oldPassword = 1[(validate.rules).string = {min_len: 1,max_len: 64}];
   string password= 2[(validate.rules).string = {min_len: 1,max_len: 64}];
}

message UpdateCurrentUserPasswordReply {
}

message UpdateUserinfoRequest {
  message Info {
    string field = 1[(validate.rules).string = {min_len: 1,max_len: 64}];
    string value = 2[(validate.rules).string = {min_len: 1,max_len: 500}];
  }
  uint32 id = 1[(validate.rules).uint32 = {gte: 1}];
}

message UpdateUserinfoReply {}


message ResetUserPasswordRequest{
    uint32 id = 1[(validate.rules).uint32 = {gte: 1}];
}

message OfflineUserRequest{
  uint32 userId = 1[(validate.rules).uint32 = {gte: 1}];
  repeated uint32 appIds = 2;
}